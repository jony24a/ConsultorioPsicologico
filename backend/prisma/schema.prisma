generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Personal {
  numero_documento Int     @id
  tipo_documento   String  @db.VarChar(10)
  nombre           String  @db.VarChar(50)
  genero           String  @db.VarChar(50)
  estrato          String  @db.VarChar(50)
  barrio           String  @db.VarChar(50)
  localidad        String  @db.VarChar(50)
  es_profesional   Boolean @default(false)
  turno            String  @db.VarChar(20)

  Citas Cita[] @relation("PersonalCita")
}

model Paciente {
  numero_documento Int    @id
  tipo_documento   String @db.VarChar(10)
  nombre           String @db.VarChar(50)
  telefono         String @db.VarChar(50)
  genero           String @db.VarChar(50)
  estrato          String @db.VarChar(50)
  barrio           String @db.VarChar(50)
  localidad        String @db.VarChar(50)
  escolaridad      String @db.VarChar(50)
  disponibilidad   String @db.VarChar(100)

  Citas            Cita[]             @relation("PacienteCita")
  HistorialClinico HistorialClinico[]
}

model Consultorio {
  id     Int    @id @default(autoincrement())
  nombre String @db.VarChar(50)
  estado String @db.VarChar(20) // "disponible", "mantenimiento", etc.
  Citas  Cita[]
}

model Cita {
  id_cita          Int                @id @default(autoincrement())
  fecha            DateTime // Fecha de la cita
  hora             DateTime           @db.Time
  lugar            String             @db.VarChar(50)
  pacienteId       Int
  personalId       Int
  consultorioId    Int
  Paciente         Paciente           @relation("PacienteCita", fields: [pacienteId], references: [numero_documento])
  Personal         Personal           @relation("PersonalCita", fields: [personalId], references: [numero_documento])
  Consultorio      Consultorio        @relation(fields: [consultorioId], references: [id])
  HistorialClinico HistorialClinico[]
}

model HistorialClinico {
  id              Int      @id @default(autoincrement())
  motivo_consulta String   @db.VarChar(100)
  remitido        String   @db.VarChar(100)
  diagnostico     String   @db.VarChar(200)
  tratamiento     String   @db.VarChar(200)
  estado_proceso  String   @db.VarChar(50)
  pacienteId      Int
  citaId          Int?     // Permitir nulo
  Cita            Cita?    @relation(fields: [citaId], references: [id_cita], onDelete: SetNull)
  Paciente        Paciente @relation(fields: [pacienteId], references: [numero_documento])
}


model HistorialConversacion {
  id            Int      @id @default(autoincrement())
  numeroUsuario String   @unique
  tratDatos     String   @default("")
  historial     Json?
  agendamiento  Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTimeÂ @updatedAt
}